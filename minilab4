import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.linear_model import LinearRegression

# Загрузка данных
data = pd.read_csv('C:/Users/USER/PycharmProjects/pythonProject5/датасет-1.csv', sep=';')  # Путь к файлу
data['price'] = data['price'].str.replace(',', '.').astype(float)
data['area'] = data['area'].astype(float)

# Визуализация исходных данных
plt.figure(figsize=(10, 6))
plt.scatter(data['area'], data['price'], color='crimson', label='Данные')
plt.xlabel('Площадь (кв.м.)', fontsize=12)
plt.ylabel('Стоимость (млн.руб)', fontsize=12)
plt.title('Зависимость стоимости от площади', fontsize=14)
plt.grid(True, linestyle='--', alpha=0.7)
plt.legend()
plt.show()

# Обучение модели линейной регрессии
model = LinearRegression()
model.fit(data[['area']], data['price'])

# Прогнозирование для конкретных значений
area_38 = 38
area_200 = 200
prediction_38 = model.predict([[area_38]])[0]
prediction_200 = model.predict([[area_200]])[0]

print(f"Предсказанная цена квартиры {area_38} м²: {prediction_38:.2f} млн руб")
print(f"Предсказанная цена квартиры {area_200} м²: {prediction_200:.2f} млн руб")

# Параметры модели
print(f"Коэффициент наклона (a): {model.coef_[0]:.4f}")
print(f"Коэффициент сдвига (b): {model.intercept_:.4f}")

# Визуализация с линией регрессии
plt.figure(figsize=(10, 6))
plt.scatter(data['area'], data['price'], color='crimson', label='Данные')
plt.plot(data['area'], model.predict(data[['area']]),
         color='navy', linewidth=2, label='Линия регрессии')
plt.xlabel('Площадь (кв.м.)', fontsize=12)
plt.ylabel('Стоимость (млн.руб)', fontsize=12)
plt.title('Линейная регрессия: стоимость vs площадь', fontsize=14)
plt.grid(True, linestyle='--', alpha=0.7)
plt.legend()
plt.show()

# Загрузка данных для прогнозирования
new_areas = pd.read_csv('C:/Users/USER/PycharmProjects/pythonProject5/prediction_price.csv')

# Прогнозирование цен
price_predictions = model.predict(new_areas)

# Добавление прогнозируемых цен в DataFrame
new_areas['predicted_price'] = price_predictions

# Вывод результатов
print("\nПрогнозируемые цены:")
print(new_areas)

# Сохранение результатов в Excel
output_file = 'predicted_prices.xlsx'
new_areas.to_excel(output_file, index=False)
print(f"\nРезультаты сохранены в файл: {output_file}")  
